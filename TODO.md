Add the possibility to pass already an idempotency key

Review the Java version to see what other things we can do

Add tests